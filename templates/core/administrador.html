{% extends 'core/base.html' %}
{% load static %}

{% block title %}Panel Administrador{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'core/css/administrador.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-root">

  <!-- TOPBAR -->
  <header class="topbar" role="banner">
    <div class="topbar-inner">
      <div class="topbar-left">
        <img src="{% static 'core/img/logo.png' %}" alt="Logo" class="topbar-logo">
        <div class="topbar-title">Dashboard Administrador</div>
      </div>

      <div class="topbar-right">
        <nav class="top-links" aria-label="Top links">
          <a href="#" class="top-link">Empresa</a>
          <a href="#" class="top-link">Para Empresas</a>
        </nav>

        <button class="btn ingresar">INGRESAR</button>
        <button class="avatar" aria-hidden="true">ğŸ‘¤</button>

        <!-- Hamburger (three stacked bars). Visible only on mobile via CSS -->
        <button id="hamburger" class="hamburger" aria-label="Abrir menÃº" aria-expanded="false">
          <span class="bar"></span>
          <span class="bar"></span>
          <span class="bar"></span>
        </button>
      </div>
    </div>
  </header>

  <!-- Overlay for mobile menu -->
  <div id="overlay" class="overlay" aria-hidden="true"></div>

  <!-- SIDEBAR (desktop) & offcanvas (mobile) -->
  <aside id="sidebar" class="sidebar" aria-hidden="false" role="navigation" aria-label="Sidebar">
    <div class="sidebar-inner">

      <!-- Mobile header inside menu (visible only on mobile) -->
      <div class="sidebar-header-mobile" id="sidebarHeaderMobile" aria-hidden="true">
        <div class="sidebar-mobile-left">
          <img src="{% static 'core/img/logo.png' %}" alt="logo" class="sidebar-mobile-logo">
          <div class="sidebar-mobile-title">MenÃº Administrador</div>
        </div>
        <button id="closeSidebar" class="close-sidebar" aria-label="Cerrar menÃº">âœ–</button>
      </div>

      <!-- duplicated top-links for mobile (hidden on desktop) -->
      <div class="mobile-toplinks">
        <a href="#" class="menu-item mobile-link"><span class="ico">ğŸ¢</span><span>Empresa</span></a>
        <a href="#" class="menu-item mobile-link"><span class="ico">ğŸ“£</span><span>Para Empresas</span></a>
      </div>

      <!-- Main nav -->
      <nav class="menu" aria-label="NavegaciÃ³n principal">
        <a href="#" class="menu-item active"><span class="ico">ğŸ </span><span>Inicio</span></a>
        <a href="#" class="menu-item"><span class="ico">ğŸšš</span><span>Vals Asignaciones</span></a>
        <a href="#" class="menu-item"><span class="ico">âœï¸</span><span>Editar</span></a>
        <a href="#" class="menu-item"><span class="ico">ğŸ“‹</span><span>GestiÃ³n de Flota</span></a>
        <a href="#" class="menu-item"><span class="ico">ğŸ‘·</span><span>Operadores</span></a>
        <a href="#" class="menu-item"><span class="ico">ğŸš—</span><span>VehÃ­culos</span></a>
        <a href="#" class="menu-item"><span class="ico">ğŸ“¥</span><span>Solicitudes Recibidas</span></a>
        <a href="#" class="menu-item"><span class="ico">ğŸ“¦</span><span>Mis Ofertas</span></a>
        <a href="#" class="menu-item"><span class="ico">âš™ï¸</span><span>ConfiguraciÃ³n</span></a>
      </nav>

      <div class="sidebar-footer">Â© 2025 Â· InformaciÃ³n Legal</div>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main" role="main">
    <div class="container">

      <!-- KPIs -->
      <section class="kpis" aria-label="EstadÃ­sticas principales">
        <article class="kpi" data-kpi="validaciones" tabindex="0">
          <h4>Validaciones</h4>
          <div class="kpi-number">17</div>
          <div class="kpi-sub">Validaciones Pendientes (17)</div>
        </article>

        <article class="kpi" data-kpi="empresas" tabindex="0">
          <h4>Empresas Registradas</h4>
          <div class="kpi-number">125</div>
          <div class="kpi-sub">50 Servicios Activos Hoy</div>
        </article>

        <article class="kpi" data-kpi="servicios" tabindex="0">
          <h4>Servicios Registrados</h4>
          <div class="kpi-number">48</div>
          <div class="kpi-sub">Activos</div>
        </article>
      </section>

      <!-- Accesos rÃ¡pidos -->
      <section class="quick-access">
        <h5>Accesos RÃ¡pidos</h5>
        <div class="actions">
          <button class="btn btn-accent">Nueva Solicitud</button>
          <button class="btn btn-outline">Registrar Empresa</button>
          <button class="btn btn-disabled" disabled>Generar Enpote</button>
        </div>
      </section>

      <!-- Resumen, chart y tareas -->
      <section class="summary-row">
        <div class="summary-cards">
          <div class="card small">
            <h6>VehÃ­culos Disponibles</h6>
            <p>Total: 22</p>
          </div>
          <div class="card small">
            <h6>Operadores Activos</h6>
            <p>Activos: 22</p>
          </div>
          <div class="card small action-card">
            <h6>Crear Nueva Oferta</h6>
            <p>Revisar empresa "LogÃ­stica del Sur"</p>
            <button class="btn btn-blue full">GENERAR OFERTA</button>
          </div>
        </div>

        <div class="chart-tasks">
          <div class="chart">
            <h6>Actividad Mensual</h6>
            <img src="{% static 'core/img/chart-placeholder.png' %}" alt="GrÃ¡fico">
          </div>
          <aside class="tasks">
            <h6>Lista de Tareas Pendientes</h6>
            <ul>
              <li>Revisar empresa "LogÃ­stica del Sur"</li>
              <li>Generar oferta para Transporte Alfa</li>
            </ul>
          </aside>
        </div>
      </section>

      <!-- Tabla -->
      <section class="table-section">
        <h5>Solicitudes de Servicio Recibidas</h5>
        <div class="table-wrap">
          <table class="table">
            <thead>
              <tr><th>ID</th><th>Ruta</th><th>Cliente</th><th>Estado</th><th>Fecha</th><th>Indicador</th></tr>
            </thead>
            <tbody>
              <tr><td>1</td><td>Cali - BogotÃ¡</td><td>LogÃ­stica del Sur</td><td>En Curso</td><td>10/10</td><td><span class="dot orange"></span></td></tr>
              <tr><td>2</td><td>Eruta</td><td>Validar empresa era</td><td>Pendiente</td><td>12/10</td><td><span class="dot blue"></span></td></tr>
              <tr><td>3</td><td>Pendiente</td><td>Confirmado</td><td>Completado</td><td>15/10</td><td><span class="dot gray"></span></td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <div class="page-footer"></div>
    </div>
  </main>
</div>

<!-- JS: toggles, keyboard a11y, KPI selection -->
<script>
(function(){
  const hamburger = document.getElementById('hamburger');
  const sidebar = document.getElementById('sidebar');
  const closeSidebar = document.getElementById('closeSidebar');
  const overlay = document.getElementById('overlay');
  const menuItems = document.querySelectorAll('.menu-item');
  const kpis = document.querySelectorAll('.kpi');

  function openSidebar() {
    sidebar.classList.add('open');
    overlay.classList.add('visible');
    document.body.classList.add('no-scroll');
    if (hamburger) hamburger.setAttribute('aria-expanded', 'true');
  }
  function closeSidebarFn() {
    sidebar.classList.remove('open');
    overlay.classList.remove('visible');
    document.body.classList.remove('no-scroll');
    if (hamburger) hamburger.setAttribute('aria-expanded', 'false');
  }

  if (hamburger) {
    hamburger.addEventListener('click', (e) => {
      if (sidebar.classList.contains('open')) closeSidebarFn();
      else openSidebar();
      e.stopPropagation();
    });
  }

  if (closeSidebar) closeSidebar.addEventListener('click', closeSidebarFn);
  if (overlay) overlay.addEventListener('click', closeSidebarFn);

  // menu items: set active (desktop + mobile). On mobile do not auto-close (per request).
  menuItems.forEach(it => {
    it.addEventListener('click', (e) => {
      menuItems.forEach(i => i.classList.remove('active'));
      it.classList.add('active');
      e.stopPropagation();
    });
  });

  // KPI selection persistent glow
  kpis.forEach(card => {
    card.addEventListener('click', () => {
      kpis.forEach(c => c.classList.remove('kpi-active'));
      card.classList.add('kpi-active');
    });
    card.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); card.click(); }
    });
  });

  // ensure resets on resize > 900px
  window.addEventListener('resize', () => {
    if (window.innerWidth > 900) closeSidebarFn();
  });

  // initial fix so mobile starts at top
  window.addEventListener('load', () => { window.scrollTo(0,0); });
})();
</script>
{% endblock %}